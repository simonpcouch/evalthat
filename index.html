<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>LLM Evaluation in R • evalthat</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="LLM Evaluation in R">
<meta name="description" content="Provides testthat-style utilities for evaluating large language models in R. Score models with non-deterministic output using a unit test interface.">
<meta property="og:description" content="Provides testthat-style utilities for evaluating large language models in R. Score models with non-deterministic output using a unit test interface.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">evalthat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/model-grading.html">Model grading</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/simonpcouch/evalthat/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="evalthat">evalthat<a class="anchor" aria-label="anchor" href="#evalthat"></a>
</h1></div>
<!-- badges: start -->

<p>evalthat provides a testthat-style framework for LLM evaluation in R. If you can write unit tests, you can compare performance across various LLMs, improve your prompts using evidence, and quantify variability in model output.</p>
<blockquote>
<p>Caution!</p>
<p>This package is very early in its development and much of its documentation is aspirational.</p>
</blockquote>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of evalthat like so:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"simonpcouch/evalthat"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>evalthat code looks a lot like testthat code. Here’s an example:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">function</span><span class="op">(</span><span class="va">chat</span> <span class="op">=</span> <span class="fu">ellmer</span><span class="fu">::</span><span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_claude.html" class="external-link">chat_claude</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">test_that</span><span class="op">(</span><span class="st">"model can make a basic histogram"</span>, <span class="op">{</span></span>
<span>    <span class="va">input</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/io.html">input</a></span><span class="op">(</span></span>
<span>      <span class="st">"Write ggplot code to plot a histogram of the mpg variable in mtcars. </span></span>
<span><span class="st">       Return only the plotting code, no backticks and no exposition."</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/io.html">output</a></span><span class="op">(</span><span class="va">chat</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span><span class="va">input</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># check that output was syntactically code R code</span></span>
<span>    <span class="fu"><a href="reference/expect_r_code.html">expect_r_code</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># match keywords to affirm intended functionality</span></span>
<span>    <span class="fu">expect_match</span><span class="op">(</span><span class="va">output</span>, <span class="st">"ggplot("</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="fu">expect_match</span><span class="op">(</span><span class="va">output</span>, <span class="st">"aes("</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="fu">expect_match</span><span class="op">(</span><span class="va">output</span>, <span class="st">"geom_histogram("</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># flag output for grading either by yourself or an LLM judge</span></span>
<span>    <span class="va">target</span> <span class="op">&lt;-</span> <span class="st">"ggplot(mtcars) + aes(x = mpg) + geom_histogram()"</span></span>
<span>    <span class="fu"><a href="reference/grade_output.html">grade_output</a></span><span class="op">(</span><span class="va">target</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>testthat users will notice a couple changes:</p>
<ul>
<li>The testing file is wrapped in <code>function()</code> with arguments defining variables to evaluate <code>across</code>. Unlike typical test files, evals are meant to be ran across many configurations to help users compare prompts, model providers, etc.</li>
<li>The functions <code><a href="reference/io.html">input()</a></code> and <code><a href="reference/io.html">output()</a></code> flag “what went into the model?” and “what came out?”</li>
<li>In addition to the regular <code>expect_*()</code> functions from testthat, the package supplies a number of new expectation functions that are helpful in evaluating R code contained in a character string (as it will be when outputted from ellmer or its extensions). Those that begin with <code>expect_*()</code> are automated, those that begin with <code>grade_*()</code> are less-so.</li>
</ul>
<p>Running the above test file results in a persistent <em>result file</em>—think of it like a snapshot. evalthat supplies a number of helpers for working with result files, allowing you to compare performance across various models, iterate on prompts, quantify variability in output, and so on. On the full ggplot2 example file, we could run 5 passes evaluating several different models for revising ggplot2 code:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ellmer.tidyverse.org" class="external-link">ellmer</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/evaluate.html">evaluate</a></span><span class="op">(</span></span>
<span>  <span class="st">"tests/evalthat/test-ggplot2.R"</span>,</span>
<span>  across <span class="op">=</span> <span class="fu">tibble</span><span class="op">(</span>chat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_openai.html" class="external-link">chat_openai</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"gpt-4o"</span>, echo <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_openai.html" class="external-link">chat_openai</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"gpt-4o-mini"</span>, echo <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_claude.html" class="external-link">chat_claude</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"claude-3-5-sonnet-latest"</span>, echo <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ellmer.tidyverse.org/reference/chat_ollama.html" class="external-link">chat_ollama</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"qwen2.5-coder:14b"</span>, echo <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span>,</span>
<span>  repeats <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="inst/ex_eval.gif"></p>
<p>Evaluation functions return a data frame with information on the evaluation results for further analysis:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eval</span></span>
<span><span class="co">#&gt; # A tibble: 20 × 8</span></span>
<span><span class="co">#&gt;    chat              pct n_fail n_pass timestamp file_hash io           problems</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;list&gt;       &lt;list&gt;  </span></span>
<span><span class="co">#&gt;  1 ollama qwen2.5…  94.4      4     67 20250115… a801f5a8… &lt;named list&gt; &lt;list&gt;  </span></span>
<span><span class="co">#&gt;  2 ollama qwen2.5…  85.9     10     61 20250115… a801f5a8… &lt;named list&gt; &lt;list&gt;  </span></span>
<span><span class="co">#&gt;  3 ollama qwen2.5…  91.5      6     65 20250115… a801f5a8… &lt;named list&gt; &lt;list&gt;  </span></span>
<span><span class="co">#&gt;  4 ollama qwen2.5…  88.7      8     63 20250115… a801f5a8… &lt;named list&gt; &lt;list&gt;  </span></span>
<span><span class="co">#&gt;  5 ollama qwen2.5…  83.1     12     59 20250115… a801f5a8… &lt;named list&gt; &lt;list&gt;  </span></span>
<span><span class="co">#&gt;  6 Claude claude-… 100        0     71 20250115… a801f5a8… &lt;named list&gt; &lt;list&gt;  </span></span>
<span><span class="co">#&gt;  7 Claude claude-…  97.2      2     69 20250115… a801f5a8… &lt;named list&gt; &lt;list&gt;  </span></span>
<span><span class="co">#&gt;  8 Claude claude-… 100        0     71 20250115… a801f5a8… &lt;named list&gt; &lt;list&gt;  </span></span>
<span><span class="co">#&gt;  9 Claude claude-…  98.6      1     70 20250115… a801f5a8… &lt;named list&gt; &lt;list&gt;  </span></span>
<span><span class="co">#&gt; 10 Claude claude-… 100        0     71 20250115… a801f5a8… &lt;named list&gt; &lt;list&gt;  </span></span>
<span><span class="co">#&gt; 11 OpenAI gpt-4o-…  95.8      3     68 20250115… a801f5a8… &lt;named list&gt; &lt;list&gt;  </span></span>
<span><span class="co">#&gt; 12 OpenAI gpt-4o-…  94.4      4     67 20250115… a801f5a8… &lt;named list&gt; &lt;list&gt;  </span></span>
<span><span class="co">#&gt; 13 OpenAI gpt-4o-…  90.1      7     64 20250115… a801f5a8… &lt;named list&gt; &lt;list&gt;  </span></span>
<span><span class="co">#&gt; 14 OpenAI gpt-4o-…  94.4      4     67 20250115… a801f5a8… &lt;named list&gt; &lt;list&gt;  </span></span>
<span><span class="co">#&gt; 15 OpenAI gpt-4o-…  94.4      4     67 20250115… a801f5a8… &lt;named list&gt; &lt;list&gt;  </span></span>
<span><span class="co">#&gt; 16 OpenAI gpt-4o    95.8      3     68 20250115… a801f5a8… &lt;named list&gt; &lt;list&gt;  </span></span>
<span><span class="co">#&gt; 17 OpenAI gpt-4o    93.0      5     66 20250115… a801f5a8… &lt;named list&gt; &lt;list&gt;  </span></span>
<span><span class="co">#&gt; 18 OpenAI gpt-4o    95.8      3     68 20250115… a801f5a8… &lt;named list&gt; &lt;list&gt;  </span></span>
<span><span class="co">#&gt; 19 OpenAI gpt-4o    94.4      4     67 20250115… a801f5a8… &lt;named list&gt; &lt;list&gt;  </span></span>
<span><span class="co">#&gt; 20 OpenAI gpt-4o    97.2      2     69 20250115… a801f5a8… &lt;named list&gt; &lt;list&gt;</span></span></code></pre></div>
<p>Visualizing this example output:</p>
<p><img src="inst/ex_plot.png" alt="A ggplot2 histogram, showing distributions of performance on the task 'translating R erroring code to cli' for three different models: Claude 3.5 Sonner, GPT-4o, and GPT-4o-mini. They all pass with flying colors, probably indicating the need for a harder eval." width="100%"></p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/simonpcouch/evalthat/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/simonpcouch/evalthat/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing evalthat</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Simon Couch <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-5676-5107" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://CRAN.R-project.org/package=evalthat" class="external-link"><img src="https://www.r-pkg.org/badges/version/evalthat" alt="CRAN status"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Simon Couch.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
